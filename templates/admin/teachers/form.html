{% extends "admin/base_admin.html" %}

{% block title %}{{ 'Editar' if teacher else 'Adicionar' }} Professor{% endblock %}

{% block content %}
<div class="p-8 max-w-4xl mx-auto bg-white rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-6">{{ 'Editar' if teacher else 'Adicionar' }} Professor</h1>
    
    <form method="POST" class="space-y-6">
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700">Nome Completo:</label>
            <input type="text" id="name" name="name" value="{{ teacher.name if teacher else '' }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>
        
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700">E-mail de Contato:</label>
            <input type="email" id="email" name="email" value="{{ teacher.contact_info.get('email', '') if teacher else '' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>
        
        <div>
            <label for="phone" class="block text-sm font-medium text-gray-700">Telefone de Contato:</label>
            <input type="tel" id="phone" name="phone" value="{{ teacher.contact_info.get('phone', '') if teacher else '' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        </div>
        
        <h3 class="text-xl font-semibold mt-8">Modalidades e Graduações</h3>
        <div id="disciplines-container" class="space-y-4">
            {% if teacher and teacher.disciplines %}
                {% for discipline in teacher.disciplines %}
                    <div class="discipline-item flex flex-wrap items-end gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <label for="discipline_name_{{ loop.index0 }}" class="block text-sm font-medium text-gray-700">Modalidade:</label>
                            <input type="text" name="discipline_name_{{ loop.index0 }}" id="discipline_name_{{ loop.index0 }}" value="{{ discipline.discipline_name }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                        <div class="flex-1 min-w-[200px]">
                            <label for="graduation_{{ loop.index0 }}" class="block text-sm font-medium text-gray-700">Graduação:</label>
                            <input type="text" name="graduation_{{ loop.index0 }}" id="graduation_{{ loop.index0 }}" value="{{ discipline.graduation }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                        <button type="button" class="remove-discipline px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow hover:bg-red-600 transition-colors">Remover</button>
                    </div>
                {% endfor %}
            {% else %}
                <div class="discipline-item flex flex-wrap items-end gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <label for="discipline_name_0" class="block text-sm font-medium text-gray-700">Modalidade:</label>
                        <input type="text" name="discipline_name_0" id="discipline_name_0" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label for="graduation_0" class="block text-sm font-medium text-gray-700">Graduação:</label>
                        <input type="text" name="graduation_0" id="graduation_0" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <button type="button" class="remove-discipline px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow hover:bg-red-600 transition-colors">Remover</button>
                </div>
            {% endif %}
        </div>
        <button type="button" id="add-discipline" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg shadow-sm hover:bg-gray-300 transition-colors mt-4">
            Adicionar Outra Modalidade
        </button>
        
        <div>
            <label for="description" class="block text-sm font-medium text-gray-700">Descrição:</label>
            <textarea id="description" name="description" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">{{ teacher.description if teacher else '' }}</textarea>
        </div>
        
        <div class="flex justify-end mt-6">
            <button type="submit" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
                {{ 'Salvar Alterações' if teacher else 'Adicionar Professor' }}
            </button>
        </div>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addDisciplineBtn = document.getElementById('add-discipline');
        const disciplinesContainer = document.getElementById('disciplines-container');
        
        // Define o índice inicial para novos campos
        let disciplineIndex = disciplinesContainer.children.length; 
        
        // Função para adicionar um novo campo de disciplina
        function addDisciplineField() {
            const div = document.createElement('div');
            div.classList.add('discipline-item', 'flex', 'flex-wrap', 'items-end', 'gap-4');
            div.innerHTML = `
                <div class="flex-1 min-w-[200px]">
                    <label for="discipline_name_${disciplineIndex}" class="block text-sm font-medium text-gray-700">Modalidade:</label>
                    <input type="text" name="discipline_name_${disciplineIndex}" id="discipline_name_${disciplineIndex}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <div class="flex-1 min-w-[200px]">
                    <label for="graduation_${disciplineIndex}" class="block text-sm font-medium text-gray-700">Graduação:</label>
                    <input type="text" name="graduation_${disciplineIndex}" id="graduation_${disciplineIndex}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <button type="button" class="remove-discipline px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow hover:bg-red-600 transition-colors">Remover</button>
            `;
            disciplinesContainer.appendChild(div);
            disciplineIndex++;
        }

        // Função para reajustar os nomes dos campos após a remoção
        function updateDisciplineFieldNames() {
            const items = disciplinesContainer.querySelectorAll('.discipline-item');
            items.forEach((item, index) => {
                const disciplineNameInput = item.querySelector(`input[name^="discipline_name_"]`);
                const graduationInput = item.querySelector(`input[name^="graduation_"]`);
                
                if (disciplineNameInput) {
                    disciplineNameInput.name = `discipline_name_${index}`;
                    disciplineNameInput.id = `discipline_name_${index}`;
                }
                if (graduationInput) {
                    graduationInput.name = `graduation_${index}`;
                    graduationInput.id = `graduation_${index}`;
                }
                
                const labels = item.querySelectorAll('label');
                if(labels.length > 0) {
                    labels[0].htmlFor = `discipline_name_${index}`;
                    labels[1].htmlFor = `graduation_${index}`;
                }
            });
            disciplineIndex = items.length; // Atualiza o índice para o próximo novo item
        }

        // Se for um novo professor e não houver campos, adiciona um
        if (!({{ teacher is defined and teacher.disciplines | length > 0 }})) {
             if (disciplinesContainer.children.length === 0) {
                addDisciplineField();
            }
        }

        // Evento para o botão de adicionar
        addDisciplineBtn.addEventListener('click', addDisciplineField);

        // Evento de delegação para o botão de remover
        disciplinesContainer.addEventListener('click', function(event) {
            if (event.target.classList.contains('remove-discipline')) {
                // Garante que pelo menos um campo de disciplina permaneça
                if (disciplinesContainer.children.length > 1) {
                    event.target.closest('.discipline-item').remove();
                    updateDisciplineFieldNames(); // Reajusta os nomes
                } else {
                    // Prevenir a remoção do último campo
                    console.log('É necessário ter pelo menos uma modalidade.');
                }
            }
        });
    });
</script>
{% endblock %}
